{
  "title": "Replace your weak home router, with pfSense!",
  "publishedAt": "2021-09-19",
  "summary": "Recently, I decided to switch from my standard cheap home router, to a custom virtual machine running pfSense on my server. This blog post will contain all the hurdles and issues that I went through, and how you can setup this up for yourself!",
  "image": "https://github.com/DavidIlie/davidilie.com/assets/47594764/abca51a7-7433-47ac-bc36-dc8a9499b369",
  "tags": [
    "Home Network",
    "pfSense",
    "Security"
  ],
  "body": {
    "raw": "\n# Video version\n\nThis blog post is actually a modified script of the video on my [youtube](https://www.youtube.com/channel/UC92hn9Y8WcY_5LribMDW8uA) channel. If you don't want to read the post, you can watch the video here:\n\n<YouTubeVideo url=\"https://www.youtube.com/embed/NwNfNV2neVc\" />\n\n# Introduction\n\nThe internet, some of us use it for consuming content, some of us use it for basic business duties and then people such as myself provide services for the other two by means of programming. Nonetheless, technology has empowered us with the opportunity to have access to the internet at our fingertips, and to the comfort of our homes via our montly subscription to access the internet.\n\nOkay okay, no more cheesy introductions. Letâ€™s get straight to the point. Iâ€™m pretty sure youâ€™ve all seen this little guy around your house somewhere.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/ont-router.jpg\"\n   alt=\"The standard home-router.\"\n   width={800}\n   height={800}\n/>\n\nThe proper term for these guys is an ONT/Router which most of the time means:\n\n-  It act as a modem (allowing you to connect your network to the outer-world via a fiber-optic-cable)\n-  It act as a router (allowing you to connect home devices to your network and let them communicate with each other)\n-  Finally, it provides a Wi-Fi access point to you and your family.\n\nFor most people this device would be great, and it is! Thatâ€™s why so many ISPs prefer to give one of these multipurpose devices instead of 3 different devices.\n\n# The Idea\n\nHowever, if youâ€™re more technical, and have 3 servers in your attic, it can get really annoying that some of the options on your router's interface (such as preferred DNS servers, etc) are blocked by default to prevent you from bricking your entire home network, which Iâ€™ve done in the past.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/home-cluster.png\"\n   alt=\"My home infastructure.\"\n   width={1295}\n   height={410}\n/>\n\n# The problem\n\nFor the past month now, Iâ€™ve been having issues with my internet connection where it would work fine for a couple of days, and then randomly would just stop working. And I mean completely, dead. Sometimes I would be able to load one web page but then have to wait an obscene amount of time for the page to load, but most of the time it just times out. The last time it happened, I managed to run some tests in my network and saw that for every 10 packets that would be sent out from my router, 5 of them would be lost, which means a 50% packet loss!\n\nObviously I was annoyed and every time this happened, I would ring up my ISP, and here is what they would say most of the time:\n\n<Callout italic>\n   \"Unfortunately sir, there is a major problem with our line in your area.\n   Please wait a couple of hours and it should come back.\"\n</Callout>\n\nIn those cases I just waited it out and then, low and behold, my internet would come back! However, I was working on my computer and this problem happened again, I thought it might have been another outage, so I decided to call them to check:\n\n<Callout italic>\n   \"Currently there are no reported outages in your area, I will have to run\n   some more tests but it looks like the latency is too high and most requests\n   time out.\"\n</Callout>\n\nLatency is the problem?! I knew it. I ran some tests and saw that there was a 50% packet loss which must mean there is a problem with my router, or the system on the other end, as later in the call they clarified that the fiber connection is stable.\n\n## Monitoring the problem\n\nAbout 7 days ago, I set up a simple raspberry pi with a couple of docker containers monitoring my internet connection by running a speedtest every 30 minutes, and then displaying it in a nice Grafana dashboard, and this is where I saw the real problem.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/monitoring-pi.png\"\n   alt=\"Custom Grafana dashboard with metrics.\"\n   width={806}\n   height={683}\n/>\n\nLooking at these two points, we can see that there are moments where my speed goes relatively lower than normal. In addition, I looked at my router's metrics and thought about this:\n\nWhat if my router is running out of resources because:\n\n-  30 Wi-Fi Clients\n-  40 Wired Devices\n\nConsidering this, a basic home network wouldn't have this many devices flowing through it, so I knew the problem might be that the router is too weak to handle all of this load, and I do have about 150GB of ram and 16 cores lying around unused in my serverâ€¦\n\n<Callout emoji=\"ðŸ¤”\">\n   Okay, a router doesnâ€™t really need that much resources but this did give me\n   an idea. My current router is like a pet, it's restricted by default, really\n   simple, and a lot of maintenance is required when something goes wrong.\n   However, if I build the router myself, and use highly documented software, I\n   can freely configure any part of the router to my needs, and have it be part\n   of my cattle infrastructure.\n</Callout>\n\n# The new system\n\nWhen I bought Nucleus, I specifically made sure that 2 of the 4 ethernet ports in the server can be passed through to a virtual machine, and I already have a pfsense virtual machine created from a couple of months back.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/iommu-pci-device.png\"\n   alt=\"IOMMU passthrough in Proxmox.\"\n   width={432}\n   height={201}\n/>\n\n# Prerequisites\n\nThere are two _well-known_ ways to accomplish a setup like this:\n\n-  Connect fiber-optic cable directly to the VM\n-  Change router to bridge mode to connect to VM (This is the one I will talk about)\n\n<Callout>\n   Bridge mode disables the built-in router and Wi-Fi portions and only leaves\n   the modem, exposing the connection to any ethernet port on the router which\n   can be plugged in to another router.\n</Callout>\n\nGetting a router into bridge mode can be relatively differnet so I won't tell you how to do it. But if you can't see it in your router's web page or you can't modifiy it, you can call your ISP like I did.\n\nIn my case, they immediately put my router in bridge mode, meaning I lost access to the internet.\n\n# Connecting the WAN and LAN ports\n\nWhen my ISP routed my fiber cable a year ago, they decided to put it under my desk, which is not very useful when my server is in my attic. Thankfully, I already had an ethernet cable going up there for my servers so I decided to re-use that one.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/server-wan-lan.jpg\"\n   alt=\"My WAN and LAN cables connected to my server.\"\n   width={1448}\n   height={1086}\n/>\n\nYes, my servers are sitting on a box. Don't make fun of me!\n\nThen you need to connect the LAN cable to your main switch so that other clients can connect to pfSense's LAN.\n\n<Image\n   src=\"/content/replace-your-home-router-with-pfsense/home-switch.jpg\"\n   alt={`My \"main\" switch connecting my home to the internet.`}\n   width={1448}\n   height={1086}\n/>\n\nWith that done, we can then pass through those two ports to the virtual machine and start the VM!\n\n# Configuring the Virtual Machine\n\nThere is not much that I can show you as it would\n\n-  Show private information about my server\n-  Every setup is different!\n   -  My configuration might not work for you!\n\nBecause of this, I recommend you to follow some tutorials online to get your router configured. I recommend this video below by [NetworkChuck](https://www.youtube.com/c/NetworkChuck) as it clearly shows how to configure pfSense to your needs.\n\n<YouTubeVideo url=\"https://www.youtube.com/embed/lUzSsX4T4WQ\" />\n\n# Conclusion\n\nBy fully taking control of your router, it enables more capabilities than what you had before (granted, there are now risks of bricking your internet). Here are some key things I did to my pfSense install to protect my home network\n\n-  You can change default DNS servers to anything you want (like Pi-Hole)\n-  You can install custom plugins\n   -  Run your own VPN instead of running it inside your network\n-  You can add custom firewalls is required for things like port forwarding\n\nand so much more...\n\nAnyways, hope you enjoyed this blog post. I also will start making blog posts for every single video that I post, so that you can have a readable version of my video.\n",
    "code": "var Component=(()=>{var sn=Object.create;var j=Object.defineProperty;var un=Object.getOwnPropertyDescriptor;var mn=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,hn=Object.prototype.hasOwnProperty;var G=(c,n)=>()=>(n||c((n={exports:{}}).exports,n),n.exports),bn=(c,n)=>{for(var f in n)j(c,f,{get:n[f],enumerable:!0})},ge=(c,n,f,h)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let _ of mn(n))!hn.call(c,_)&&_!==f&&j(c,_,{get:()=>n[_],enumerable:!(h=un(n,_))||h.enumerable});return c};var vn=(c,n,f)=>(f=c!=null?sn(fn(c)):{},ge(n||!c||!c.__esModule?j(f,\"default\",{value:c,enumerable:!0}):f,c)),_n=c=>ge(j({},\"__esModule\",{value:!0}),c);var Ue=G((wn,we)=>{we.exports=React});var Ee=G(H=>{\"use strict\";(function(){\"use strict\";var c=Ue(),n=Symbol.for(\"react.element\"),f=Symbol.for(\"react.portal\"),h=Symbol.for(\"react.fragment\"),_=Symbol.for(\"react.strict_mode\"),X=Symbol.for(\"react.profiler\"),K=Symbol.for(\"react.provider\"),J=Symbol.for(\"react.context\"),R=Symbol.for(\"react.forward_ref\"),D=Symbol.for(\"react.suspense\"),A=Symbol.for(\"react.suspense_list\"),T=Symbol.for(\"react.memo\"),F=Symbol.for(\"react.lazy\"),Ie=Symbol.for(\"react.offscreen\"),Q=Symbol.iterator,Ce=\"@@iterator\";function Se(e){if(e===null||typeof e!=\"object\")return null;var r=Q&&e[Q]||e[Ce];return typeof r==\"function\"?r:null}var g=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function b(e){{for(var r=arguments.length,t=new Array(r>1?r-1:0),a=1;a<r;a++)t[a-1]=arguments[a];Pe(\"error\",e,t)}}function Pe(e,r,t){{var a=g.ReactDebugCurrentFrame,l=a.getStackAddendum();l!==\"\"&&(r+=\"%s\",t=t.concat([l]));var s=t.map(function(o){return String(o)});s.unshift(\"Warning: \"+r),Function.prototype.apply.call(console[e],console,s)}}var Oe=!1,je=!1,De=!1,Ae=!1,Fe=!1,Z;Z=Symbol.for(\"react.module.reference\");function We(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===h||e===X||Fe||e===_||e===D||e===A||Ae||e===Ie||Oe||je||De||typeof e==\"object\"&&e!==null&&(e.$$typeof===F||e.$$typeof===T||e.$$typeof===K||e.$$typeof===J||e.$$typeof===R||e.$$typeof===Z||e.getModuleId!==void 0))}function Me(e,r,t){var a=e.displayName;if(a)return a;var l=r.displayName||r.name||\"\";return l!==\"\"?t+\"(\"+l+\")\":t}function ee(e){return e.displayName||\"Context\"}function y(e){if(e==null)return null;if(typeof e.tag==\"number\"&&b(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case h:return\"Fragment\";case f:return\"Portal\";case X:return\"Profiler\";case _:return\"StrictMode\";case D:return\"Suspense\";case A:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case J:var r=e;return ee(r)+\".Consumer\";case K:var t=e;return ee(t._context)+\".Provider\";case R:return Me(e,e.render,\"ForwardRef\");case T:var a=e.displayName||null;return a!==null?a:y(e.type)||\"Memo\";case F:{var l=e,s=l._payload,o=l._init;try{return y(o(s))}catch{return null}}}return null}var x=Object.assign,E=0,ne,ie,re,te,ae,de,oe;function le(){}le.__reactDisabledLog=!0;function Ye(){{if(E===0){ne=console.log,ie=console.info,re=console.warn,te=console.error,ae=console.group,de=console.groupCollapsed,oe=console.groupEnd;var e={configurable:!0,enumerable:!0,value:le,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}E++}}function Ve(){{if(E--,E===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:x({},e,{value:ne}),info:x({},e,{value:ie}),warn:x({},e,{value:re}),error:x({},e,{value:te}),group:x({},e,{value:ae}),groupCollapsed:x({},e,{value:de}),groupEnd:x({},e,{value:oe})})}E<0&&b(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var W=g.ReactCurrentDispatcher,M;function I(e,r,t){{if(M===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\\n( *(at )?)/);M=a&&a[1]||\"\"}return`\n`+M+e}}var Y=!1,C;{var Le=typeof WeakMap==\"function\"?WeakMap:Map;C=new Le}function ce(e,r){if(!e||Y)return\"\";{var t=C.get(e);if(t!==void 0)return t}var a;Y=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var s;s=W.current,W.current=null,Ye();try{if(r){var o=function(){throw Error()};if(Object.defineProperty(o.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(o,[])}catch(N){a=N}Reflect.construct(e,[],o)}else{try{o.call()}catch(N){a=N}e.call(o.prototype)}}else{try{throw Error()}catch(N){a=N}e()}}catch(N){if(N&&a&&typeof N.stack==\"string\"){for(var d=N.stack.split(`\n`),v=a.stack.split(`\n`),u=d.length-1,m=v.length-1;u>=1&&m>=0&&d[u]!==v[m];)m--;for(;u>=1&&m>=0;u--,m--)if(d[u]!==v[m]){if(u!==1||m!==1)do if(u--,m--,m<0||d[u]!==v[m]){var p=`\n`+d[u].replace(\" at new \",\" at \");return e.displayName&&p.includes(\"<anonymous>\")&&(p=p.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&C.set(e,p),p}while(u>=1&&m>=0);break}}}finally{Y=!1,W.current=s,Ve(),Error.prepareStackTrace=l}var U=e?e.displayName||e.name:\"\",xe=U?I(U):\"\";return typeof e==\"function\"&&C.set(e,xe),xe}function $e(e,r,t){return ce(e,!1)}function Be(e){var r=e.prototype;return!!(r&&r.isReactComponent)}function S(e,r,t){if(e==null)return\"\";if(typeof e==\"function\")return ce(e,Be(e));if(typeof e==\"string\")return I(e);switch(e){case D:return I(\"Suspense\");case A:return I(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case R:return $e(e.render);case T:return S(e.type,r,t);case F:{var a=e,l=a._payload,s=a._init;try{return S(s(l),r,t)}catch{}}}return\"\"}var P=Object.prototype.hasOwnProperty,se={},ue=g.ReactDebugCurrentFrame;function O(e){if(e){var r=e._owner,t=S(e.type,e._source,r?r.type:null);ue.setExtraStackFrame(t)}else ue.setExtraStackFrame(null)}function qe(e,r,t,a,l){{var s=Function.call.bind(P);for(var o in e)if(s(e,o)){var d=void 0;try{if(typeof e[o]!=\"function\"){var v=Error((a||\"React class\")+\": \"+t+\" type `\"+o+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[o]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw v.name=\"Invariant Violation\",v}d=e[o](r,o,a,t,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(u){d=u}d&&!(d instanceof Error)&&(O(l),b(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",a||\"React class\",t,o,typeof d),O(null)),d instanceof Error&&!(d.message in se)&&(se[d.message]=!0,O(l),b(\"Failed %s type: %s\",t,d.message),O(null))}}}var Ge=Array.isArray;function V(e){return Ge(e)}function He(e){{var r=typeof Symbol==\"function\"&&Symbol.toStringTag,t=r&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return t}}function ze(e){try{return me(e),!1}catch{return!0}}function me(e){return\"\"+e}function fe(e){if(ze(e))return b(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",He(e)),me(e)}var k=g.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0},he,be,L;L={};function Ke(e){if(P.call(e,\"ref\")){var r=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(r&&r.isReactWarning)return!1}return e.ref!==void 0}function Je(e){if(P.call(e,\"key\")){var r=Object.getOwnPropertyDescriptor(e,\"key\").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function Qe(e,r){if(typeof e.ref==\"string\"&&k.current&&r&&k.current.stateNode!==r){var t=y(k.current.type);L[t]||(b('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',y(k.current.type),e.ref),L[t]=!0)}}function Ze(e,r){{var t=function(){he||(he=!0,b(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};t.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:t,configurable:!0})}}function en(e,r){{var t=function(){be||(be=!0,b(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};t.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:t,configurable:!0})}}var nn=function(e,r,t,a,l,s,o){var d={$$typeof:n,type:e,key:r,ref:t,props:o,_owner:s};return d._store={},Object.defineProperty(d._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(d,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(d,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.freeze&&(Object.freeze(d.props),Object.freeze(d)),d};function rn(e,r,t,a,l){{var s,o={},d=null,v=null;t!==void 0&&(fe(t),d=\"\"+t),Je(r)&&(fe(r.key),d=\"\"+r.key),Ke(r)&&(v=r.ref,Qe(r,l));for(s in r)P.call(r,s)&&!Xe.hasOwnProperty(s)&&(o[s]=r[s]);if(e&&e.defaultProps){var u=e.defaultProps;for(s in u)o[s]===void 0&&(o[s]=u[s])}if(d||v){var m=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;d&&Ze(o,m),v&&en(o,m)}return nn(e,d,v,l,a,k.current,o)}}var $=g.ReactCurrentOwner,ve=g.ReactDebugCurrentFrame;function w(e){if(e){var r=e._owner,t=S(e.type,e._source,r?r.type:null);ve.setExtraStackFrame(t)}else ve.setExtraStackFrame(null)}var B;B=!1;function q(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===n}function _e(){{if($.current){var e=y($.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function tn(e){{if(e!==void 0){var r=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),t=e.lineNumber;return`\n\nCheck your code at `+r+\":\"+t+\".\"}return\"\"}}var pe={};function an(e){{var r=_e();if(!r){var t=typeof e==\"string\"?e:e.displayName||e.name;t&&(r=`\n\nCheck the top-level render call using <`+t+\">.\")}return r}}function ye(e,r){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var t=an(r);if(pe[t])return;pe[t]=!0;var a=\"\";e&&e._owner&&e._owner!==$.current&&(a=\" It was passed a child from \"+y(e._owner.type)+\".\"),w(e),b('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',t,a),w(null)}}function Ne(e,r){{if(typeof e!=\"object\")return;if(V(e))for(var t=0;t<e.length;t++){var a=e[t];q(a)&&ye(a,r)}else if(q(e))e._store&&(e._store.validated=!0);else if(e){var l=Se(e);if(typeof l==\"function\"&&l!==e.entries)for(var s=l.call(e),o;!(o=s.next()).done;)q(o.value)&&ye(o.value,r)}}}function dn(e){{var r=e.type;if(r==null||typeof r==\"string\")return;var t;if(typeof r==\"function\")t=r.propTypes;else if(typeof r==\"object\"&&(r.$$typeof===R||r.$$typeof===T))t=r.propTypes;else return;if(t){var a=y(r);qe(t,e.props,\"prop\",a,e)}else if(r.PropTypes!==void 0&&!B){B=!0;var l=y(r);b(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",l||\"Unknown\")}typeof r.getDefaultProps==\"function\"&&!r.getDefaultProps.isReactClassApproved&&b(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function on(e){{for(var r=Object.keys(e.props),t=0;t<r.length;t++){var a=r[t];if(a!==\"children\"&&a!==\"key\"){w(e),b(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",a),w(null);break}}e.ref!==null&&(w(e),b(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),w(null))}}function ln(e,r,t,a,l,s){{var o=We(e);if(!o){var d=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(d+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var v=tn(l);v?d+=v:d+=_e();var u;e===null?u=\"null\":V(e)?u=\"array\":e!==void 0&&e.$$typeof===n?(u=\"<\"+(y(e.type)||\"Unknown\")+\" />\",d=\" Did you accidentally export a JSX literal instead of a component?\"):u=typeof e,b(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",u,d)}var m=rn(e,r,t,l,s);if(m==null)return m;if(o){var p=r.children;if(p!==void 0)if(a)if(V(p)){for(var U=0;U<p.length;U++)Ne(p[U],e);Object.freeze&&Object.freeze(p)}else b(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else Ne(p,e)}return e===h?on(m):dn(m),m}}var cn=ln;H.Fragment=h,H.jsxDEV=cn})()});var Re=G((En,ke)=>{\"use strict\";ke.exports=Ee()});var xn={};bn(xn,{default:()=>Nn,frontmatter:()=>pn});var i=vn(Re()),pn={title:\"Replace your weak home router, with pfSense!\",publishedAt:\"2021-09-19\",summary:\"Recently, I decided to switch from my standard cheap home router, to a custom virtual machine running pfSense on my server. This blog post will contain all the hurdles and issues that I went through, and how you can setup this up for yourself!\",image:\"https://github.com/DavidIlie/davidilie.com/assets/47594764/abca51a7-7433-47ac-bc36-dc8a9499b369\",tags:[\"Home Network\",\"pfSense\",\"Security\"]};function Te(c){let n=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",ul:\"ul\",li:\"li\",h2:\"h2\",em:\"em\"},c.components),{YouTubeVideo:f,Image:h,Callout:_}=n;return _||z(\"Callout\",!0,\"56:1-59:11\"),h||z(\"Image\",!0,\"24:1-29:3\"),f||z(\"YouTubeVideo\",!0,\"16:1-16:65\"),(0,i.jsxDEV)(i.Fragment,{children:[(0,i.jsxDEV)(n.h1,{id:\"video-version\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#video-version\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Video version\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:12,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:[\"This blog post is actually a modified script of the video on my \",(0,i.jsxDEV)(n.a,{href:\"https://www.youtube.com/channel/UC92hn9Y8WcY_5LribMDW8uA\",children:\"youtube\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:14,columnNumber:65},this),\" channel. If you don't want to read the post, you can watch the video here:\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:14,columnNumber:1},this),`\n`,(0,i.jsxDEV)(f,{url:\"https://www.youtube.com/embed/NwNfNV2neVc\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:16,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"introduction\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#introduction\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Introduction\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:18,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"The internet, some of us use it for consuming content, some of us use it for basic business duties and then people such as myself provide services for the other two by means of programming. Nonetheless, technology has empowered us with the opportunity to have access to the internet at our fingertips, and to the comfort of our homes via our montly subscription to access the internet.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:20,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Okay okay, no more cheesy introductions. Let\\u2019s get straight to the point. I\\u2019m pretty sure you\\u2019ve all seen this little guy around your house somewhere.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:22,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/ont-router.jpg\",alt:\"The standard home-router.\",width:800,height:800},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:24,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"The proper term for these guys is an ONT/Router which most of the time means:\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:31,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"It act as a modem (allowing you to connect your network to the outer-world via a fiber-optic-cable)\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:33,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:\"It act as a router (allowing you to connect home devices to your network and let them communicate with each other)\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:34,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:\"Finally, it provides a Wi-Fi access point to you and your family.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:35,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:33,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"For most people this device would be great, and it is! That\\u2019s why so many ISPs prefer to give one of these multipurpose devices instead of 3 different devices.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:37,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"the-idea\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#the-idea\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"The Idea\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:39,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"However, if you\\u2019re more technical, and have 3 servers in your attic, it can get really annoying that some of the options on your router's interface (such as preferred DNS servers, etc) are blocked by default to prevent you from bricking your entire home network, which I\\u2019ve done in the past.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:41,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/home-cluster.png\",alt:\"My home infastructure.\",width:1295,height:410},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:43,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"the-problem\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#the-problem\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"The problem\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:50,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"For the past month now, I\\u2019ve been having issues with my internet connection where it would work fine for a couple of days, and then randomly would just stop working. And I mean completely, dead. Sometimes I would be able to load one web page but then have to wait an obscene amount of time for the page to load, but most of the time it just times out. The last time it happened, I managed to run some tests in my network and saw that for every 10 packets that would be sent out from my router, 5 of them would be lost, which means a 50% packet loss!\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:52,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Obviously I was annoyed and every time this happened, I would ring up my ISP, and here is what they would say most of the time:\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:54,columnNumber:1},this),`\n`,(0,i.jsxDEV)(_,{italic:!0,children:(0,i.jsxDEV)(n.p,{children:`\"Unfortunately sir, there is a major problem with our line in your area.\nPlease wait a couple of hours and it should come back.\"`},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:57,columnNumber:4},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:56,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"In those cases I just waited it out and then, low and behold, my internet would come back! However, I was working on my computer and this problem happened again, I thought it might have been another outage, so I decided to call them to check:\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:61,columnNumber:1},this),`\n`,(0,i.jsxDEV)(_,{italic:!0,children:(0,i.jsxDEV)(n.p,{children:`\"Currently there are no reported outages in your area, I will have to run\nsome more tests but it looks like the latency is too high and most requests\ntime out.\"`},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:64,columnNumber:4},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:63,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Latency is the problem?! I knew it. I ran some tests and saw that there was a 50% packet loss which must mean there is a problem with my router, or the system on the other end, as later in the call they clarified that the fiber connection is stable.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:69,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h2,{id:\"monitoring-the-problem\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#monitoring-the-problem\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Monitoring the problem\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:71,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"About 7 days ago, I set up a simple raspberry pi with a couple of docker containers monitoring my internet connection by running a speedtest every 30 minutes, and then displaying it in a nice Grafana dashboard, and this is where I saw the real problem.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:73,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/monitoring-pi.png\",alt:\"Custom Grafana dashboard with metrics.\",width:806,height:683},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:75,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Looking at these two points, we can see that there are moments where my speed goes relatively lower than normal. In addition, I looked at my router's metrics and thought about this:\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:82,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"What if my router is running out of resources because:\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:84,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"30 Wi-Fi Clients\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:86,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:\"40 Wired Devices\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:87,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:86,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Considering this, a basic home network wouldn't have this many devices flowing through it, so I knew the problem might be that the router is too weak to handle all of this load, and I do have about 150GB of ram and 16 cores lying around unused in my server\\u2026\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:89,columnNumber:1},this),`\n`,(0,i.jsxDEV)(_,{emoji:\"\\u{1F914}\",children:(0,i.jsxDEV)(n.p,{children:`Okay, a router doesn\\u2019t really need that much resources but this did give me\nan idea. My current router is like a pet, it's restricted by default, really\nsimple, and a lot of maintenance is required when something goes wrong.\nHowever, if I build the router myself, and use highly documented software, I\ncan freely configure any part of the router to my needs, and have it be part\nof my cattle infrastructure.`},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:92,columnNumber:4},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:91,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"the-new-system\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#the-new-system\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"The new system\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:100,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"When I bought Nucleus, I specifically made sure that 2 of the 4 ethernet ports in the server can be passed through to a virtual machine, and I already have a pfsense virtual machine created from a couple of months back.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:102,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/iommu-pci-device.png\",alt:\"IOMMU passthrough in Proxmox.\",width:432,height:201},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:104,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"prerequisites\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#prerequisites\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Prerequisites\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:111,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:[\"There are two \",(0,i.jsxDEV)(n.em,{children:\"well-known\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:113,columnNumber:15},this),\" ways to accomplish a setup like this:\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:113,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"Connect fiber-optic cable directly to the VM\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:115,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:\"Change router to bridge mode to connect to VM (This is the one I will talk about)\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:116,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:115,columnNumber:1},this),`\n`,(0,i.jsxDEV)(_,{children:(0,i.jsxDEV)(n.p,{children:`Bridge mode disables the built-in router and Wi-Fi portions and only leaves\nthe modem, exposing the connection to any ethernet port on the router which\ncan be plugged in to another router.`},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:119,columnNumber:4},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:118,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Getting a router into bridge mode can be relatively differnet so I won't tell you how to do it. But if you can't see it in your router's web page or you can't modifiy it, you can call your ISP like I did.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:124,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"In my case, they immediately put my router in bridge mode, meaning I lost access to the internet.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:126,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"connecting-the-wan-and-lan-ports\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#connecting-the-wan-and-lan-ports\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Connecting the WAN and LAN ports\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:128,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"When my ISP routed my fiber cable a year ago, they decided to put it under my desk, which is not very useful when my server is in my attic. Thankfully, I already had an ethernet cable going up there for my servers so I decided to re-use that one.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:130,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/server-wan-lan.jpg\",alt:\"My WAN and LAN cables connected to my server.\",width:1448,height:1086},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:132,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Yes, my servers are sitting on a box. Don't make fun of me!\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:139,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Then you need to connect the LAN cable to your main switch so that other clients can connect to pfSense's LAN.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:141,columnNumber:1},this),`\n`,(0,i.jsxDEV)(h,{src:\"/content/replace-your-home-router-with-pfsense/home-switch.jpg\",alt:'My \"main\" switch connecting my home to the internet.',width:1448,height:1086},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:143,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"With that done, we can then pass through those two ports to the virtual machine and start the VM!\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:150,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"configuring-the-virtual-machine\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#configuring-the-virtual-machine\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Configuring the Virtual Machine\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:152,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"There is not much that I can show you as it would\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:154,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"Show private information about my server\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:156,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:[\"Every setup is different!\",`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"My configuration might not work for you!\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:158,columnNumber:4},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:158,columnNumber:4},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:157,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:156,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:[\"Because of this, I recommend you to follow some tutorials online to get your router configured. I recommend this video below by \",(0,i.jsxDEV)(n.a,{href:\"https://www.youtube.com/c/NetworkChuck\",children:\"NetworkChuck\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:160,columnNumber:129},this),\" as it clearly shows how to configure pfSense to your needs.\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:160,columnNumber:1},this),`\n`,(0,i.jsxDEV)(f,{url:\"https://www.youtube.com/embed/lUzSsX4T4WQ\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:162,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.h1,{id:\"conclusion\",children:[(0,i.jsxDEV)(n.a,{className:\"anchor\",href:\"#conclusion\",children:(0,i.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this),\"Conclusion\"]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:164,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"By fully taking control of your router, it enables more capabilities than what you had before (granted, there are now risks of bricking your internet). Here are some key things I did to my pfSense install to protect my home network\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:166,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"You can change default DNS servers to anything you want (like Pi-Hole)\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:168,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:[\"You can install custom plugins\",`\n`,(0,i.jsxDEV)(n.ul,{children:[`\n`,(0,i.jsxDEV)(n.li,{children:\"Run your own VPN instead of running it inside your network\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:170,columnNumber:4},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:170,columnNumber:4},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:169,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.li,{children:\"You can add custom firewalls is required for things like port forwarding\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:171,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:168,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"and so much more...\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:173,columnNumber:1},this),`\n`,(0,i.jsxDEV)(n.p,{children:\"Anyways, hope you enjoyed this blog post. I also will start making blog posts for every single video that I post, so that you can have a readable version of my video.\"},void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:175,columnNumber:1},this)]},void 0,!0,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\",lineNumber:1,columnNumber:1},this)}function yn(c={}){let{wrapper:n}=c.components||{};return n?(0,i.jsxDEV)(n,Object.assign({},c,{children:(0,i.jsxDEV)(Te,c,void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this)}),void 0,!1,{fileName:\"/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx\"},this):Te(c)}var Nn=yn;function z(c,n,f){throw new Error(\"Expected \"+(n?\"component\":\"object\")+\" `\"+c+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(f?\"\\nIt\\u2019s referenced in your code at `\"+f+\"` in `/Users/david/dev/davidilie.com/content/_mdx_bundler_entry_point-67999f28-372a-442a-8c2a-76d4be41c5d4.mdx`\":\"\"))}return _n(xn);})();\n/*! Bundled license information:\n\nreact/cjs/react-jsx-dev-runtime.development.js:\n  (**\n   * @license React\n   * react-jsx-dev-runtime.development.js\n   *\n   * Copyright (c) Facebook, Inc. and its affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *)\n*/\n;return Component;"
  },
  "_id": "replace-your-home-router-with-pfsense.mdx",
  "_raw": {
    "sourceFilePath": "replace-your-home-router-with-pfsense.mdx",
    "sourceFileName": "replace-your-home-router-with-pfsense.mdx",
    "sourceFileDir": ".",
    "contentType": "mdx",
    "flattenedPath": "replace-your-home-router-with-pfsense"
  },
  "type": "Blog",
  "slug": "replace-your-home-router-with-pfsense",
  "slugAsParams": "",
  "structuredData": {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Replace your weak home router, with pfSense!",
    "datePublished": "2021-09-19",
    "dateModified": "2021-09-19",
    "description": "Recently, I decided to switch from my standard cheap home router, to a custom virtual machine running pfSense on my server. This blog post will contain all the hurdles and issues that I went through, and how you can setup this up for yourself!",
    "image": "https://github.com/DavidIlie/davidilie.com/assets/47594764/abca51a7-7433-47ac-bc36-dc8a9499b369",
    "url": "https://davidilie.com/blog/replace-your-home-router-with-pfsense",
    "author": {
      "@type": "Person",
      "name": "David Ilie"
    }
  }
}